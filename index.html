<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Multi-Context HiRAG - Enhanced PHQ-9 Assessment</title>
    <style>
        /* ===== Design Tokens ===== */
        :root{
            --bg-grad-start:#eef2ff;
            --bg-grad-end:#f5f3ff;

            --surface:#ffffff;
            --surface-2:#fafafa;

            --text:#1f2937;
            --muted:#6b7280;

            --primary:#2563eb;   /* blue-600 */
            --primary-50:#eff6ff;
            --primary-100:#dbeafe;

            --ring:rgba(37,99,235,.15);
            --border:#e5e7eb;
            --shadow:0 10px 30px rgba(0,0,0,.08);

            --radius-lg:16px;
            --radius-md:12px;
            --radius-sm:8px;

            --gap-lg:24px;
            --gap-md:16px;
            --gap-sm:10px;

            /* Tag colors for PHQ items (subtle, consistent) */
            --phq1-bg:#fff7d6; --phq1-bd:#f59e0b;
            --phq2-bg:#ffe8d6; --phq2-bd:#fb923c;
            --phq3-bg:#e8f7ec; --phq3-bd:#22c55e;
            --phq4-bg:#e8f1ff; --phq4-bd:#3b82f6;
            --phq6-bg:#f3e8ff; --phq6-bd:#a855f7;
            --phq8-bg:#ffe5e5; --phq8-bd:#ef4444;

            --ok:#22c55e;
            --warn:#f59e0b;
            --danger:#ef4444;
        }

        /* ===== Base ===== */
        *{box-sizing:border-box}
        html,body{height:100%}
        body{
            font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
            color:var(--text);
            margin:0;
            background:linear-gradient(145deg,var(--bg-grad-start),var(--bg-grad-end));
        }
        .container{
            max-width:1200px;
            margin:0 auto;
            padding:28px 20px 40px;
        }
        .card{
            background:var(--surface);
            border:1px solid var(--border);
            border-radius:var(--radius-lg);
            box-shadow:var(--shadow);
            padding:28px;
        }
        h1{
            margin:0 0 18px;
            font-weight:700;
            font-size:28px;
            line-height:1.2;
            text-align:center;
            color:var(--text);
        }
        h1 + .subtitle{
            margin:-6px auto 22px;
            text-align:center;
            color:var(--muted);
            font-size:14px;
        }

        /* ===== Tabs ===== */
        .context-tabs{
            display:flex;
            gap:8px;
            border-bottom:1px solid var(--border);
            margin-bottom:18px;
            flex-wrap:wrap;
        }
        .tab{
            appearance:none;
            border:none;
            background:transparent;
            padding:10px 14px;
            border-radius:10px 10px 0 0;
            font-weight:600;
            color:var(--muted);
            cursor:pointer;
            position:relative;
            transition:all .2s ease;
        }
        .tab:hover{color:var(--text); background:var(--primary-50)}
        .tab.active{
            color:var(--primary);
            background:var(--surface);
            box-shadow:inset 0 -2px 0 var(--primary);
        }
        .tab:focus-visible{
            outline:2px solid var(--primary);
            outline-offset:2px;
        }

        /* ===== Tab Content ===== */
        .tab-content{
            display:none;
            padding:18px;
            border-radius:var(--radius-md);
            background:var(--surface-2);
            border:1px solid var(--border);
            margin-bottom:18px;
        }
        .tab-content.active{display:block}

        /* Context tint */
        .context-clinical{ background:linear-gradient(0deg,#f6fff8, #ffffff); }
        .context-research{ background:linear-gradient(0deg,#f3f7ff, #ffffff); }
        .context-guidelines{ background:linear-gradient(0deg,#fffaf3, #ffffff); }
        .context-cases{ background:linear-gradient(0deg,#fbf7ff, #ffffff); }

        /* ===== Evidence Grid ===== */
        .evidence-grid{
            display:grid;
            grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
            gap:var(--gap-md);
            margin-top:var(--gap-sm);
        }
        .evidence-card{
            background:var(--surface);
            border:1px solid var(--border);
            border-radius:var(--radius-md);
            padding:16px;
            transition:transform .15s ease, box-shadow .15s ease, border-color .15s ease;
        }
        .evidence-card:hover{
            transform:translateY(-2px);
            border-color:#dbe3f7;
            box-shadow:0 12px 24px rgba(37,99,235,.07);
        }
        .evidence-card h4{
            margin:0 0 8px;
            font-size:16px;
        }
        .evidence-card small{color:var(--muted)}

        /* ===== Tags for PHQ items ===== */
        .phq1,.phq2,.phq3,.phq4,.phq6,.phq8{
            display:inline-flex;
            align-items:center;
            gap:6px;
            padding:2px 8px;
            margin:0 2px;
            border-radius:6px;
            font-weight:600;
            font-size:13px;
            border:1px solid transparent;
            box-shadow:0 0 0 0 rgba(0,0,0,0);
            transition:box-shadow .2s ease, transform .08s ease;
        }
        .phq1{background:var(--phq1-bg); border-color:var(--phq1-bd)}
        .phq2{background:var(--phq2-bg); border-color:var(--phq2-bd)}
        .phq3{background:var(--phq3-bg); border-color:var(--phq3-bd)}
        .phq4{background:var(--phq4-bg); border-color:var(--phq4-bd)}
        .phq6{background:var(--phq6-bg); border-color:var(--phq6-bd)}
        .phq8{background:var(--phq8-bg); border-color:var(--phq8-bd)}

        .context-badge{
            position:relative;
            top:-1px;
            background:#111827;
            color:#fff;
            font-size:10px;
            padding:2px 6px;
            border-radius:4px;
            font-weight:600;
        }

        /* Confidence glow (subtle) */
        .confidence-high{ box-shadow:0 0 0 3px rgba(34,197,94,.18) }
        .confidence-medium{ box-shadow:0 0 0 3px rgba(245,158,11,.18) }
        .confidence-low{ box-shadow:0 0 0 3px rgba(239,68,68,.14) }

        /* ===== Transcript ===== */
        .section{
            margin:28px 0;
            padding:20px;
            border-radius:var(--radius-lg);
            border:1px solid var(--border);
            background:var(--surface);
        }
        .highlighted-transcript{ background:linear-gradient(180deg,#fffdf6,#ffffff); }

        .conversation-line{
            margin:10px 0;
            padding:12px 14px;
            border-radius:10px;
            border:1px solid var(--border);
            background:var(--surface-2);
            transition:transform .15s ease, box-shadow .15s ease;
        }
        .conversation-line:hover{
            transform:translateX(4px);
            box-shadow:0 8px 18px rgba(0,0,0,.06);
        }
        .conversation-line .speaker{ font-weight:700; color:#111827; margin-right:6px }

        .ellie{ border-left:4px solid var(--primary); background:linear-gradient(0deg, var(--primary-100), #fff) }
        .participant{ border-left:4px solid #a855f7; background:linear-gradient(0deg, #f5f3ff, #fff) }

        /* ===== Consensus Bar ===== */
        .consensus-bar{
            width:100%; height:8px; border-radius:999px; background:#eef2f7; overflow:hidden; margin:8px 0 6px;
        }
        .consensus-fill{ height:100%; transition:width .5s ease }
        .consensus-high{ background:linear-gradient(90deg,#22c55e,#86efac) }
        .consensus-medium{ background:linear-gradient(90deg,#f59e0b,#fde68a) }
        .consensus-low{ background:linear-gradient(90deg,#ef4444,#fca5a5) }

        /* ===== Tooltips ===== */
        .tooltip{ position:relative; cursor:help }
        .tooltip::after{
            content:attr(data-tooltip);
            position:absolute;
            bottom:calc(100% + 8px);
            left:50%;
            transform:translateX(-50%) translateY(4px);
            opacity:0;
            pointer-events:none;
            background:#111827;
            color:#fff;
            padding:6px 8px;
            font-size:12px;
            border-radius:6px;
            white-space:nowrap;
            transition:opacity .15s ease, transform .15s ease;
            box-shadow:0 8px 20px rgba(0,0,0,.18);
            z-index:10;
        }
        .tooltip:hover::after{ opacity:1; transform:translateX(-50%) translateY(0) }

        /* ===== Assessment Dashboard ===== */
        .assessment-dashboard{
            background:linear-gradient(180deg,#f6fbff,#ffffff);
            border:1px solid var(--border);
            border-radius:var(--radius-lg);
            padding:20px;
            margin:24px 0;
        }
        .score-visualization{
            display:flex;
            gap:12px;
            justify-content:center;
            flex-wrap:wrap;
            margin:14px 0 8px;
        }
        .score-circle{
            width:88px; height:88px;
            border-radius:50%;
            display:flex; align-items:center; justify-content:center;
            font-weight:800; font-size:13px; text-align:center; color:#fff;
            box-shadow:inset 0 0 0 2px rgba(255,255,255,.35), 0 8px 18px rgba(0,0,0,.08);
        }
        /* Map existing inline gradients to cleaner tones via overrides */
        .score-circle[style*="#4caf50"]{ background:linear-gradient(45deg,#16a34a,#22c55e)!important } /* OK */
        .score-circle[style*="#ffc107"]{ background:linear-gradient(45deg,#f59e0b,#fbbf24)!important } /* Warn */
        .score-circle[style*="#ff5722"]{ background:linear-gradient(45deg,#ef4444,#f97316)!important } /* Danger */

        /* ===== Buttons / Lists ===== */
        ul{ padding-left:18px }
        li{ margin:6px 0 }

        /* ===== Animations ===== */
        @keyframes pulse{
            0%{ transform:translateZ(0); box-shadow:0 0 0 0 var(--ring) }
            70%{ box-shadow:0 0 0 8px rgba(37,99,235,0) }
            100%{ box-shadow:0 0 0 0 rgba(37,99,235,0) }
        }

        /* ===== Responsive ===== */
        @media (max-width: 640px){
            .card{ padding:18px }
            .tab{ padding:8px 10px; font-size:14px }
            .score-circle{ width:78px; height:78px }
        }
    </style>

    <script>
        function showTab(tabName) {
            // Hide all tab contents
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));

            // Remove active from all tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));

            // Show selected content and activate tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function highlightEvidence(phqItem) {
            const elements = document.querySelectorAll(`.${phqItem}`);
            elements.forEach(el => {
                el.style.animation = 'pulse 1s';
                setTimeout(() => el.style.animation = '', 800);
            });
        }
    </script>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>🧠 Highlighted RAG Chain-of-Thought: </h1>
            <div class="subtitle">PHQ-9 Depression Detection</div>

            <!-- Context source tabs -->
            <div class="context-tabs">
                <button class="tab active" onclick="showTab('clinical')">🏥 Clinical Guidelines</button>
                <button class="tab" onclick="showTab('research')">🔬 Research Literature</button>
                <button class="tab" onclick="showTab('cases')">📋 Case Studies</button>
                <button class="tab" onclick="showTab('symptoms')">💊 Symptom Database</button>
            </div>

            <!-- Multi-context RAG evidence -->
            <div id="clinical" class="tab-content context-clinical active">
                <h3>🏥 Clinical Practice Guidelines Evidence</h3>
                <div class="evidence-grid">
                    <div class="evidence-card">
                        <h4>DSM-5 Criteria for Major Depression</h4>
                        <p><span class="phq1 confidence-high">Anhedonia (loss of interest/pleasure) is one of two core symptoms required for MDD diagnosis <span class="context-badge">DSM</span></span>. <span class="phq2 confidence-high">Depressed mood most of the day, nearly every day is the other core symptom <span class="context-badge">DSM</span></span>.</p>
                        <div class="consensus-bar"><div class="consensus-fill consensus-high" style="width: 95%"></div></div>
                        <small>Confidence: 95% | Source reliability: High</small>
                    </div>

                    <div class="evidence-card">
                        <h4>PHQ-9 Scoring Manual</h4>
                        <p><span class="phq3 confidence-high">Sleep disturbances include both insomnia and hypersomnia <span class="context-badge">PHQ</span></span>. <span class="phq4 confidence-medium">Fatigue or loss of energy should be distinguished from normal tiredness <span class="context-badge">PHQ</span></span>.</p>
                        <div class="consensus-bar"><div class="consensus-fill consensus-high" style="width: 88%"></div></div>
                        <small>Confidence: 88% | Source reliability: High</small>
                    </div>
                </div>
            </div>

            <div id="research" class="tab-content context-research">
                <h3>🔬 Research Literature Evidence</h3>
                <div class="evidence-grid">
                    <div class="evidence-card">
                        <h4>Meta-analysis: Depression & Sleep (2023)</h4>
                        <p><span class="phq3 confidence-high">Sleep quality shows 87% correlation with depression severity in longitudinal studies <span class="context-badge">META</span></span>. <span class="phq4 confidence-medium">Exercise engagement correlates negatively with fatigue symptoms (r=-0.72) <span class="context-badge">RCT</span></span>.</p>
                        <div class="consensus-bar"><div class="consensus-fill consensus-high" style="width: 92%"></div></div>
                        <small>Confidence: 92% | 15 studies, N=12,847</small>
                    </div>

                    <div class="evidence-card">
                        <h4>Neuroimaging Study: Anhedonia Markers</h4>
                        <p><span class="phq1 confidence-medium">Preserved engagement in multiple activities (reading, cooking, exercise) shows 78% negative predictive value for anhedonia <span class="context-badge">fMRI</span></span>.</p>
                        <div class="consensus-bar"><div class="consensus-fill consensus-medium" style="width: 78%"></div></div>
                        <small>Confidence: 78% | N=1,234 subjects</small>
                    </div>
                </div>
            </div>

            <div id="cases" class="tab-content context-cases">
                <h3>📋 Similar Case Studies Evidence</h3>
                <div class="evidence-grid">
                    <div class="evidence-card">
                        <h4>Case Similarity Score: 84%</h4>
                        <p><span class="phq2 confidence-high">Patient with similar profile (maintained activities, recent happiness) scored PHQ-9: 2/27 <span class="context-badge">CASE</span></span>. <span class="phq8 confidence-low">Periodic "shutdown" behavior may indicate mild avoidance coping <span class="context-badge">PSYC</span></span>.</p>
                        <div class="consensus-bar"><div class="consensus-fill consensus-high" style="width: 84%"></div></div>
                        <small>Matched on 7/9 PHQ criteria | 6-month follow-up negative</small>
                    </div>
                </div>
            </div>

            <div id="symptoms" class="tab-content">
                <h3>💊 Symptom Database Evidence</h3>
                <div class="evidence-grid">
                    <div class="evidence-card">
                        <h4>Symptom Pattern Recognition</h4>
                        <p><span class="phq4 confidence-medium">Irritability + laziness only when sleep-deprived occurs in 73% of non-depressed individuals <span class="context-badge">SYMP</span></span>. <span class="phq6 confidence-high">Positive self-description ("chocolate, tall, thin") indicates intact self-image <span class="context-badge">CLIN</span></span>.</p>
                        <div class="consensus-bar"><div class="consensus-fill consensus-medium" style="width: 73%"></div></div>
                        <small>Pattern match: Normal stress response</small>
                    </div>
                </div>
            </div>

            <!-- Highlighted transcript -->
            <div class="section highlighted-transcript">
                <h3>🔖 Multi-Context Highlighted Transcript</h3>

                <div class="conversation-line ellie">
                    <span class="speaker">Ellie:</span> what do you do to relax
                </div>
                <div class="conversation-line participant">
                    <span class="speaker">Participant:</span>
                    <span class="phq1 confidence-high tooltip" data-tooltip="DSM-5: Preserved interest capacity" onclick="highlightEvidence('phq1')">i like reading books <span class="context-badge">4/4</span></span>
                    <span class="phq1 confidence-high tooltip" data-tooltip="Multiple sources confirm anhedonia absence">i enjoy i enjoy cooking <span class="context-badge">3/4</span></span> um
                    <span class="phq8 confidence-medium tooltip" data-tooltip="Research: Exercise = normal psychomotor">exercising is great <span class="context-badge">2/4</span></span>
                </div>

                <div class="conversation-line ellie">
                    <span class="speaker">Ellie:</span> how easy is it for you to get a good night's sleep
                </div>
                <div class="conversation-line participant">
                    <span class="speaker">Participant:</span> uh
                    <span class="phq3 confidence-high tooltip" data-tooltip="Meta-analysis: Good sleep = 87% protective factor">it's pretty easy <span class="context-badge">4/4</span></span>
                </div>

                <div class="conversation-line ellie">
                    <span class="speaker">Ellie:</span> when was the last time you felt really happy
                </div>
                <div class="conversation-line participant">
                    <span class="speaker">Participant:</span> um
                    <span class="phq2 confidence-high tooltip" data-tooltip="Clinical: Recent positive mood rules out persistent depression">the other day <span class="context-badge">4/4</span></span>
                </div>

                <div class="conversation-line ellie">
                    <span class="speaker">Ellie:</span> what are you like when you don't sleep well
                </div>
                <div class="conversation-line participant">
                    <span class="speaker">Participant:</span>
                    <span class="phq4 confidence-medium tooltip" data-tooltip="Symptom DB: Normal response in 73% of population">irritated <span class="context-badge">3/4</span></span> um
                    <span class="phq4 confidence-medium">lazy <span class="context-badge">3/4</span></span>
                </div>

                <div class="conversation-line ellie">
                    <span class="speaker">Ellie:</span> what do you do when you're annoyed
                </div>
                <div class="conversation-line participant">
                    <span class="speaker">Participant:</span> uh
                    <span class="phq8 confidence-low tooltip" data-tooltip="Case studies: May indicate mild avoidance">shut down <span class="context-badge">1/4</span></span>
                </div>
            </div>

            <!-- Assessment dashboard -->
            <div class="assessment-dashboard">
                <h3>🎯 Multi-Context Consensus Assessment</h3>

                <div class="score-visualization">
                    <div class="score-circle" style="background: linear-gradient(45deg, #4caf50, #66bb6a);">
                        PHQ-1<br>0/3
                    </div>
                    <div class="score-circle" style="background: linear-gradient(45deg, #4caf50, #66bb6a);">
                        PHQ-2<br>0/3
                    </div>
                    <div class="score-circle" style="background: linear-gradient(45deg, #4caf50, #66bb6a);">
                        PHQ-3<br>0/3
                    </div>
                    <div class="score-circle" style="background: linear-gradient(45deg, #ffc107, #ffb74d);">
                        PHQ-4<br>0-1/3
                    </div>
                    <div class="score-circle" style="background: linear-gradient(45deg, #ff5722, #ff7043);">
                        PHQ-8<br>0-1/3
                    </div>
                </div>

                <h4>📊 Context Consensus Breakdown:</h4>
                <ul>
                    <li><strong>Clinical Guidelines Consensus:</strong> 94% agreement → No Depression</li>
                    <li><strong>Research Literature Consensus:</strong> 89% agreement → Protective factors present</li>
                    <li><strong>Case Study Similarity:</strong> 84% match → Expected PHQ-9: 1-2/27</li>
                    <li><strong>Symptom Pattern Match:</strong> 76% normal stress response pattern</li>
                </ul>

                <div style="background:#f0fdf4; border:1px solid #bbf7d0; padding:16px; border-radius:12px; margin-top:14px;">
                    <h4 style="color:#166534; margin:0 0 8px;">🏆 Final Multi-Context Assessment:</h4>
                    <p><strong>Consensus PHQ-9 Score: 0-2/27 (89% confidence)</strong></p>
                    <p><strong>Classification: No Depression / Minimal Symptoms</strong></p>
                    <p><strong>Risk Level: Low</strong></p>

                    <h5 style="margin:12px 0 6px;">Key Evidence Convergence:</h5>
                    <ul style="margin:0">
                        <li>4/4 contexts support preserved interest/pleasure</li>
                        <li>4/4 contexts confirm absence of persistent depressed mood</li>
                        <li>4/4 contexts validate good sleep as protective factor</li>
                        <li>3/4 contexts explain fatigue as situational/normal</li>
                    </ul>
                </div>
            </div>

        </div>
    </div>
</body>
</html>
